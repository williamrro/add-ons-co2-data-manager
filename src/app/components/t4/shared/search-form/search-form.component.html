<ng-template #filterDropdown let-filtersList="filtersList" let-form="form" let-showClient="showClient">
	<div [formGroup]="form" class="searchFormBody" *ngIf="showClient || filtersList.length > 0">
		<div class="searchFormBody--item" *ngIf="showClient">
			<div class="searchFormBody--item__label">Client Code</div>
			<div class="searchFormBody--item__control">
				<angular2-multiselect
					id="drp_{{ CLIENT_CODE_FILTER_KEY }}"
					[data]="clientCodesList"
					formControlName="{{ CLIENT_CODE_FILTER_KEY }}"
					[settings]="CLIENT_FILTER_SETTINGS"
					(onDeSelect)="onClientDeSelect($event)"
				>
				</angular2-multiselect>
			</div>
		</div>
		<ng-container *ngFor="let filter of filtersList">
			<div class="searchFormBody--item" *ngIf="!(!isIntensityTab && filter.key === INTENSITY_FILTER_KEY)">
				<div class="searchFormBody--item__label">{{ filter.label }}</div>
				<div
					class="searchFormBody--item__control"
					[class.disabled]="!searchForm.value[CLIENT_CODE_FILTER_KEY].length > 0"
				>
					<angular2-multiselect
						id="drp_{{ filter.key }}"
						[data]="filterValues"
						formControlName="{{ filter.key }}"
						[settings]="filter.selectMode === 'single' ? SINGLE_SELECT_SETTINGS : MULTI_SELECT_SETTINGS"
						(onOpen)="onFilterOpen()"
						(onScrollToEnd)="onFilterValuesScrollToEnd($event, filter.key)"
					>
						<c-search>
							<ng-template>
								<input
									type="text"
									(keyup)="onFilterSearch(filter.key)"
									[(ngModel)]="filterValuesSearchText"
									[ngModelOptions]="{ standalone: true }"
									placeholder="Search"
								/>
							</ng-template>
						</c-search>
					</angular2-multiselect>
				</div>
			</div>
		</ng-container>
	</div>
</ng-template>

<div class="searchContainer">
	<div class="buttonsContainer" [class.noButton]="!hasFpsAccess">
		<button tabindex="0" *ngIf="hasFpsAccess" class="actionButton actionButton__green" (click)="onNavigate()">
			<span class="text">Switch to FPS Application</span>
		</button>
		<div class="formIconContainer">
			<img
				width="11px"
				height="11px"
				src="assets/img/refresh.svg"
				class="formIconContainer--icon"
				(click)="onReset()"
			/>
			<span class="formIconContainer--text" (click)="onReset()">Reset</span>
		</div>
	</div>
	<form [formGroup]="searchForm" class="searchForm" (ngSubmit)="onSearch()" *ngIf="isFiltersInitialized">
		<div class="searchFormGroup">
			<div class="searchFormTitle">Standard Filters</div>
			<ng-container
				[ngTemplateOutlet]="filterDropdown"
				[ngTemplateOutletContext]="{ form: searchForm, filtersList: standardFiltersList, showClient: true }"
			>
			</ng-container>
		</div>
		<div
			class="searchFormGroup"
			[style.minHeight.px]="customFiltersList.length > 3 ? 3 * 69 + 50 : customFiltersList.length * 69 + 50"
		>
			<div class="searchFormTitle">
				Custom Filters
				<div class="formIconContainer" (click)="togglePopup()">
					<img width="16px" height="16px" src="assets/img/settings.svg" class="formIconContainer--icon" />
					<span class="formIconContainer--text">Manage Filters</span>
				</div>
			</div>
			<ng-container
				[ngTemplateOutlet]="filterDropdown"
				[ngTemplateOutletContext]="{ form: searchForm, filtersList: customFiltersList }"
			>
			</ng-container>
		</div>
		<div class="formButton">
			<button tabindex="0" class="actionButton actionButton__green" type="submit">
				<span class="text">Search</span>
			</button>
		</div>
	</form>
</div>

<app-manage-filters
	[@directivesAnimation]
	*ngIf="showPopup && searchForm.value[CLIENT_CODE_FILTER_KEY].length > 0"
	[selectedClients]="searchForm.value[CLIENT_CODE_FILTER_KEY]"
	[selectedFilters]="customFiltersList"
	(closePopup)="togglePopup()"
	(refreshFilters)="refreshFilters()"
></app-manage-filters>
